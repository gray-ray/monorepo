## 项目初始化

```bash
npm init -y

touch  pnpm-workspace.yaml

mkdir  packages

pnpm i -D  typescript

tsc --init
```

## 相关配置

### 支持代码自动格式化 风格统一

```bash
pnpm add -D eslint prettier eslint-config-prettier eslint-plugin-prettier @typescript-eslint/parser @typescript-eslint/eslint-plugin

```

1. .editorconfig 文件 用于团队 IDE 基础设置

```ini
root = true
[*]
indent_style = space
indent_size = 2
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true
```

2. .prettierrc.json 项目格式化配置

```json
{
  "semi": false,
  "singleQuote": true,
  "trailingComma": "all",
  "printWidth": 100,
  "tabWidth": 2,
  "arrowParens": "always"
}
```

1. eslint.config.js 代码检查配置 (eslint 9.x 版本配置)

```js
import tsPlugin from '@typescript-eslint/eslint-plugin'
import prettierPlugin from 'eslint-plugin-prettier'
import parser from '@typescript-eslint/parser'

export default [
  {
    files: ['*.ts', '*.tsx', '*.js'],
    languageOptions: {
      parser: parser,
      parserOptions: { ecmaVersion: 'latest', sourceType: 'module' }
    },
    plugins: { '@typescript-eslint': tsPlugin, prettier: prettierPlugin },
    rules: {
      'prettier/prettier': 'warn',
      '@typescript-eslint/no-unused-vars': 'warn'
    }
  }
]
```

1. vscode 配置 保存自动格式化 .vscode/setting.
   > ✅ formatOnSave：保存时触发格式化
   > ✅ source.fixAll.eslint：自动修复 ESLint 可修复的错误
   > ✅ 指定 Prettier 为默认格式化器
   > 需要在 设置-> 文本编辑器 ->格式化 ->Format On Save 选项选中

```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "editor.formatOnPaste": true,

  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

### 包发布 github 相关配置

[github 中文文档](https://docs.github.com/zh)
[github 发布包 中文文档](https://docs.github.com/zh/actions)

1. .npmrc 配置

> 创建 GitHub 个人访问令牌 \_authToken
> 前往 GitHub > Settings > Developer settings > Personal access tokens
> 生成新令牌，勾选 write:packages 和 read:packages 权限
>
> 不要直接填写token `.github/workflows/ci.yml` 中会自动注入

```json
@gray-ray:registry=https://npm.pkg.github.com/
//npm.pkg.github.com/:_authToken=${NODE_AUTH_TOKEN}


```

2. 安装 github packages

```bash
pnpm add @gray-ray/package-name --registry=https://npm.pkg.github.com
```

3. github 自动构建发布配置
   在项目根目录下创建.github/workflows/ci.yml

```yaml
name: CI/CD

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build all packages
        run: pnpm -r build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-output
          path: |
            apps/web/dist
            apps/server/dist
            packages/**

  publish-npm:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: 'https://registry.npmjs.org/'

      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build all packages
        run: pnpm -r build

      - name: Publish packages to npm
        run: pnpm -r publish --access public --no-git-checks
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

### monorepo 仓库相关配置
